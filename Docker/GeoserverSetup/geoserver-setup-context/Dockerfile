FROM python:3.8

WORKDIR /usr/src/app

ARG GEOSERVER_DATA_GITHUB_REPOSITORY
ENV GEOSERVER_DATA_GITHUB_REPOSITORY=${GEOSERVER_DATA_GITHUB_REPOSITORY}
ARG GEOSERVER_DATA_GITHUB_REPOSITORY_NAME
ENV GEOSERVER_DATA_GITHUB_REPOSITORY_NAME=${GEOSERVER_DATA_GITHUB_REPOSITORY_NAME}
ARG GEOSERVER_DATA_IMPORT_DIR
ENV GEOSERVER_DATA_IMPORT_DIR=${GEOSERVER_DATA_IMPORT_DIR}

ENV DATA_IMPORT_DIR=./data_import

COPY requirements.txt ./
COPY python_setup.py ./

RUN pip install --no-cache-dir -r requirements.txt

RUN git clone -b ChemistryValleyGeoserver $GEOSERVER_DATA_GITHUB_REPOSITORY

RUN mv $GEOSERVER_DATA_GITHUB_REPOSITORY_NAME/$GEOSERVER_DATA_IMPORT_DIR $DATA_IMPORT_DIR

RUN rm -r $GEOSERVER_DATA_GITHUB_REPOSITORY_NAME

CMD ["python","-u","python_setup.py"]
